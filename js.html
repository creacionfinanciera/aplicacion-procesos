<script>
    
    // esta función es para recuperar los datos de la hoja de cálculo de google sheets
    function crearTablaContactos() {
        
        // lo primero es comprobar si existe la tabla de contactos, y si existe borrarla, si no hacemos esto, cada vez que demos clic al botón se va a generar una tabla, y me va a comenzar a mostrar la tabla repetida
        eliminarTabla();

        // aqui procedemos a crear el loder o icono de procesamiento
        // crearLoader('divContactos'); // este codigo no funciona entonces lo dejo comentado

        // el método google.script.run es una función en JavaScript que te permite llamar a funciones de Google Apps Script desde el lado del cliente (es decir, desde el código que se ejecuta en el navegador del usuario) y pasar datos entre el cliente y el servidor de manera asíncrona
        // el método ".withSuccessHandler()" es para esperar a que los datos se reciban, y en el interior ( ) es dónde pintaremos la tabla en html 
        // la función "obtenerContatos()" es la función que realmente va a obtener los datos de google sheets, y es la función que deberá programar dentro del archivo "funciones.js", que es el archivo de google apps script
        google.script.run
        .withSuccessHandler(crearTablaContactosCorrectamente)
        .withFailureHandler(crearTablaContactosError)
        .obtenerContactos();

    }

    //  con esta función vamos a crear la tabla
    function crearTablaContactosCorrectamente(obj) {
        // y acontinuaión siempre creamos nueva, la tabla en html
        tabla = document.createElement('table');
        // le creamos a la tabla un identificador
        tabla.id = 'tablaContactos';

        // dentro de una tabla en html, podemos tener un "header" y un "body"
        // aqui creamos el "header"
        let tablaHeader = document.createElement('thead');              
        // aqui creamos el "body", dentro de este cuerpo vamos a insertar cada uno de los datos que nos encontremos en el parametro "obj", que es el objeto dónde se encuentran todos los datos
        let tablaBody = document.createElement('tbody');
        // asi recorremos el objeto dónde se encuentran los datos, a través de un bucle doble, tenemos un forEach que nos recorre cada una de las filas, y por cada una de esas filas tenemos un forEach que nos recorre cada una de las celdas, entonces el bucle interno lo que hace es ir creando cada una de las celdas, ponerle texto y añadirla a la fila
        // pero debemos evaluarlo y cuando sea la primera fila, no debemos añadir la fila a la "tablaBody", sino que la debemos añadir a la "tablaHeader", entonces necesitamos un indice que nos permita hacer esto

        for (let i = 0; i < obj.length; i++) {

            // primero creamos la fila
            let fila = document.createElement('tr');
            // ahora añadir a esa fila cada una de las celdas
            for (let j = 0; j < obj[i].length; j++) {

                // creamos la celda
                let celda = document.createElement('td');
                // Guardamos dentro de la celda el contenido
                celda.textContent = obj[i][j];
                // Una vez la celda tiene el texto, ya podemos podemos añadir la celda a la fila
                fila.appendChild(celda); 

            }
            // evalúa si el índice es 0
            if (i == 0) {

                // inserta la primera fila a la "tablaHeader"
                tablaHeader.appendChild(fila);
                // agrega el header a la tabla
                tabla.appendChild(tablaHeader);

            } else {

                // inserta la fila que ya tendra adentro cada una de las celdas
                tablaBody.appendChild(fila);

            }

        }

        // agreguemos clases a la cabecera
        tablaHeader.classList.add('table-dark');
        
        // ya tenemos cada una de las filas agregadas al body, y ahora lo que falta es agregar el body a la tabla
        tabla.appendChild(tablaBody);
        
        // con lo anterior ya tenemos la tabla montada, ahora lo que vamos a hacer es añadir una serie de clases de Bootstrapt, por ejemplo la clase "table-success", la encontramos en la página de bootstrap, buscando por tabla
        tabla.classList.add('table','table-striped','border','border-4','border-dark', 'table-success');
        
        // en este punto ya podemos añadir la tabla a la estructura principal de la página, y esto lo vamos a insertar en el "div" que hemos creado previamente en el "main", con el id="divContactos"
        document.getElementById('divContactos').appendChild(tabla);

        // mostrar notificación de OK
        crearNotificacionOK('Proveedores obtenidos correctamente', 'Todo en orden')

        // eliminaremos el loader
        // eliminarLoader(); // este codigo no funciona entonces lo dejo comentado

    }

    // esta es la función que se va a ejecutar si tenemos un error al consultar los datos
    function crearTablaContactosError() {
        
        // mostrar notificación de error
        crearNotificacionError('No se han podido leer los proveedores', 'ERROR')

        // eliminaremos el loader
       // eliminarLoader(); // este codigo no funciona entonces lo dejo comentado

    }
    
    // esta es la función que manipulara el toast en el archivo "main.html" para personalizar la notificacion
    function crearNotificacion(mensaje, titulo) {

        // obtener los datos de la notificacion y editar la notificación
        document.getElementById('mensajeNotificacion').textContent = mensaje;
        document.getElementById('tituloNotificacion').textContent = titulo;
        let elementoNotificacion = document.getElementById('notificacion');

        // creamos la instancia de la notificación, para ellos nos traemos el fragmento de código de bootstrap "getOrCreateInstance"
        bootstrap.Toast.getOrCreateInstance(elementoNotificacion).show();

    }

    // creamos funciones para crear la notificación según el tipo de notificación
    function crearNotificacionOK(mensaje, titulo) {

        crearNotificacion(mensaje, titulo);
        crearIconoNotificacionOK();
        crearColorNotificacion('--color-verde-oscuro');

    }
    function crearNotificacionError(mensaje, titulo) {

        crearNotificacion(mensaje, titulo);
        crearIconoNotificacionError();
        crearColorNotificacion('--color-rojo-oscuro');

    }
    function crearNotificacionAdvertencia(mensaje, titulo) {

        crearNotificacion(mensaje, titulo);
        crearIconoNotificacionAdvertencia();
        crearColorNotificacion('--color-amarillo-oscuro');

    }
    
    // creamos funciones para crear el ícono según el tipo de notificación
    function crearIconoNotificacionOK() {
        
        document.getElementById('iconoNotificacion').className = '';
        document.getElementById('iconoNotificacion').classList.add('bi','bi-check2-square');

    }
    function crearIconoNotificacionError() {
    
        document.getElementById('iconoNotificacion').className = '';
        document.getElementById('iconoNotificacion').classList.add('bi','bi-bug');   

    }
    function crearIconoNotificacionAdvertencia() {
    
        document.getElementById('iconoNotificacion').className = '';
        document.getElementById('iconoNotificacion').classList.add('bi','bi-exclamation-square');

    }

    // creamos una función para el color
    function crearColorNotificacion(color) {

        let elementoNotificacion = document.getElementById('notificacion');
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(color);

    }

    // esta función es para colocar el loader en la parte de la página que nosotros queramos
    // la siguiente es la estructura con la que se carga en el html, que tambien es tomada de la página, y con base en ella es que vamos a construir la función
    // <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
    // <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>

    function crearLoder(elementoPadre) {

        // y aqui para evitarnos problemas, siempre que creemos el loader, para tener únicamente uno vamos a buscarlo, y si previamente lo encontramos lo borramos
        eliminarLoader();
        
        let loader = document.createElement('div');
        loader.id = 'loader';
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.classList.add('lds-ellipsis');

        // entonces cuando creemos este icono de carga, deberemos pasarle como parámetro el mombre de "id" del "div" donde vamos a incluir dentro el ícono de carga
        document.getElementById(elementoPadre).appendChild(loader);

    }

    // ahora vamos a hacer otra función que haga lo contrario, que busque el elemento, y si lo encuentra, lo destruya, para poder eliminarlo cuando haya terminado la carga de los datos
    function eliminarLoader() {

        let loader = document.getElementById('loader');
        if (loader) loader.remove();

    }

    function eliminarTabla() {

        let tabla = document.getElementById('tablaContactos');
        if (tabla) tabla.remove();

    }

    
</script>